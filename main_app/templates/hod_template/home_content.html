{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}{{page_title}}{% endblock page_title %}
{% block content %}
<section class="content">
    <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3 class="text-mode">{{total_students}}</h3>

                        <p class="text-mode">Total Students</p>
                    </div>
                    <div class="icon">
                      <i class="nav-icon fas fa-user-graduate"></i>
                    </div>
                    <a href="{% url 'manage_student' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>

                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3 class="text-mode">{{total_staff}}</h3>

                        <p class="text-mode">Total Staff</p>
                    </div>
                    <div class="icon">
                      <i class="nav-icon fas fa-users"></i>
                    </div>
                    <a href="{% url 'manage_staff' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-purple">
                    <div class="inner">
                        <h3 class="text-mode">{{total_course}}</h3>

                        <p class="text-mode">Total Course</p>
                    </div>
                    <div class="icon">
                      <i class="nav-icon fas fa-th-list"></i>
                    </div>
                    <a href="{% url 'manage_course' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-danger">
                    <div class="inner">
                        <h3 class="text-mode">{{total_subject}}</h3>

                        <p class="text-mode">Total Subjects</p>
                    </div>
                    <div class="icon">
                      <i class="nav-icon fas fa-book"></i>
                    </div>
                    <a href="{% url 'manage_subject' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
        </div>
        <!-- /.row -->
        <!-- Main row -->
        <div class="row">
            <div class="col-md-6">
                <!-- LINE CHART -->
                <div class="card card-dark">
                  <div class="card-header">
                    <h3 class="card-title text-white">Staffs - Students Overview</h3>
    
                    <div class="card-tools">
                      <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                      </button>
                      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart">
                      <canvas id="pieChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                  </div></div>
                  <!-- /.card-body -->
                </div>
                <div class="col-md-6">
                    <div class="card card-dark">
              <div class="card-header">
                <h3 class="card-title text-white">Attendance Per Subject</h3>

                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
                </div>
              </div>
              <div class="card-body">
                <div class="chart">
                  <canvas id="barChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
              </div>
              <!-- /.card-body -->
            </div>
                </div>
            <!-- right col -->
        </div>
        <!-- /.row (main row) -->
        <div class="row">
          <div class="col-lg-12">
            <!-- BAR CHART -->
            <div class="card">
              <div class="card-header bg-dark">
                <h3 class="card-title text-white">Student's Attendance & Leave Overview</h3>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool text-white" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool text-white" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div class="chart">
                  <canvas id="barChart2" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            
          </div>
        
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header bg-dark">
                        <h3 class="card-title text-white">Total Students in Each Course</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool text-white" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-tool text-white" data-card-widget="remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="courseChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header bg-dark">
                        <h3 class="card-title text-white">Total Students in Each Subject</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool text-white" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-tool text-white" data-card-widget="remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="subjectChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>

<style>
    /* Add mode-specific text colors */
    @media (prefers-color-scheme: dark) {
        .text-mode {
            color: white !important;
        }
        .chart-text-color {
            color: white !important;
        }
        .card-body {
            color: white !important;
        }
    }
    
    @media (prefers-color-scheme: light) {
        .text-mode {
            color: black !important;
        }
        .chart-text-color {
            color: black !important;
        }
        .card-body {
            color: black !important;
        }
    }
    
    /* Additional utility class for the small box footers */
    .small-box-footer {
        color: rgba(255, 255, 255, 0.8) !important;
    }
    .small-box-footer:hover {
        color: white !important;
    }
</style>
{% endblock content %}

{% block custom_js %}
<script>
$(document).ready(function(){
    // Detect dark mode
    const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    // Set text colors based on mode
    const textColor = isDarkMode ? 'white' : 'black';
    const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
    
    // Staff-Students Overview Chart
    var staffStudentData = {
        labels: ['Students', 'Staff'],
        datasets: [{
            data: [{{total_students}}, {{total_staff}}],
            backgroundColor: ['#4e73df', '#1cc88a'],
            hoverBackgroundColor: ['#2e59d9', '#17a673'],
            hoverBorderColor: "rgba(234, 236, 244, 1)"
        }]
    };

    var overviewCtx = document.getElementById('pieChart').getContext('2d');
    new Chart(overviewCtx, {
        type: 'doughnut',
        data: staffStudentData,
        options: {
            maintainAspectRatio: false,
            tooltips: {
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#000000",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
            },
            legend: {
                display: true,
                position: 'bottom',
                labels: {
                    fontColor: '#000000'
                }
            },
            cutoutPercentage: 80
        }
    });

    // Attendance Per Subject Chart
    var attendanceData = {
        labels: {{ subject_list|safe }},
        datasets: [{
            label: 'Attendance Count',
            data: {{ attendance_list }},
            backgroundColor: '#36b9cc',
            borderColor: '#36b9cc',
            borderWidth: 1
        }]
    };

    var attendanceCtx = document.getElementById('barChart').getContext('2d');
    new Chart(attendanceCtx, {
        type: 'bar',
        data: attendanceData,
        options: {
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        fontColor: '#000000'
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0.1)"
                    }
                }],
                xAxes: [{
                    ticks: {
                        fontColor: '#000000'
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0.1)"
                    }
                }]
            },
            legend: {
                display: true,
                position: 'top',
                labels: {
                    fontColor: '#000000'
                }
            }
        }
    });

    // Student's Attendance & Leave Overview
    var studentAttendanceData = {
        labels: {{ student_name_list|safe }},
        datasets: [{
            label: 'Present',
            backgroundColor: '#1cc88a',
            data: {{ student_attendance_present_list }}
        }, {
            label: 'Absent/Leave',
            backgroundColor: '#e74a3b',
            data: {{ student_attendance_leave_list }}
        }]
    };

    var studentAttendanceCtx = document.getElementById('barChart2').getContext('2d');
    new Chart(studentAttendanceCtx, {
        type: 'bar',
        data: studentAttendanceData,
        options: {
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        fontColor: '#000000'
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0.1)"
                    }
                }],
                xAxes: [{
                    ticks: {
                        fontColor: '#000000'
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0.1)"
                    }
                }]
            },
            legend: {
                display: true,
                position: 'top',
                labels: {
                    fontColor: '#000000'
                }
            }
        }
    });

    // Course Statistics
    var courseData = {
        labels: {{ course_name_list|safe }},
        datasets: [{
            label: 'Number of Students',
            data: {{ student_count_list_in_course }},
            backgroundColor: '#4e73df',
            borderColor: '#4e73df',
            borderWidth: 1
        }]
    };

    var courseCtx = document.getElementById('courseChart').getContext('2d');
    new Chart(courseCtx, {
        type: 'bar',
        data: courseData,
        options: {
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        fontColor: '#000000'
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0.1)"
                    }
                }],
                xAxes: [{
                    ticks: {
                        fontColor: '#000000'
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0.1)"
                    }
                }]
            },
            legend: {
                display: true,
                position: 'top',
                labels: {
                    fontColor: '#000000'
                }
            }
        }
    });

    // Subject Statistics
    var subjectData = {
        labels: {{ subject_list|safe }},
        datasets: [{
            label: 'Number of Students',
            data: {{ student_count_list_in_subject }},
            backgroundColor: '#1cc88a',
            borderColor: '#1cc88a',
            borderWidth: 1
        }]
    };

    var subjectCtx = document.getElementById('subjectChart').getContext('2d');
    new Chart(subjectCtx, {
        type: 'bar',
        data: subjectData,
        options: {
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        fontColor: '#000000'
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0.1)"
                    }
                }],
                xAxes: [{
                    ticks: {
                        fontColor: '#000000'
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0.1)"
                    }
                }]
            },
            legend: {
                display: true,
                position: 'top',
                labels: {
                    fontColor: '#000000'
                }
            }
        }
    });
    
    // Listen for theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        location.reload(); // Reload to apply new color scheme
    });
});
</script>
{% endblock custom_js %}